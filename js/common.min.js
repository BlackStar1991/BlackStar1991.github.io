$(document).ready(function () {

    var active = "active",
        hidden = "hidden";


    $(".bl_form__text").on("click", function () {
        $('.bl_form__text').removeClass(active);
        $(this).addClass(active);

        if ($(this).data('value') === 'phone') {
            $(".bl_form__input").addClass('js-input-tel');
            $(".bl_form__input").removeClass('js-input-email');
            $('#RegisterForm_contact').attr('placeholder', "");
            initPhoneField($("#RegisterForm_contact"), 'ua');
            $(".js-text_form").text("Телефон");

        } else {
            $(".bl_form__input").addClass('js-input-email');
            $(".bl_form__input").removeClass('js-input-tel');
            removePhoneField($("#RegisterForm_contact"));
            $('#RegisterForm_contact').attr('placeholder', "");
            $(".js-text_form").text("Email");
        }


    });



    /// Simple Validation

    var errorMessage = {
        emptyFild: "Поле должно быть заполнено",
        littleNumber: "Это не похоже на телефон",
        littlePass: "Пароль должен быть >7 знаков",
        incorrectEmail: "Поле email должно быть заполненно корректно",
        incorrectTel: "Поле телефона должно содержать только цифры",
    };
    var statusEmail = false,
        statusPass = false,
        statusTel = false;

    var errorClassEffect = "errorClassEffect";

    $(".js-input-email").on("blur", function () {

        var fild = $(this),
            fildValue = fild.val(),
            checkReg = isValidEmailAddress(fildValue),
            parrentBlock = fild.parent(".bl_form__label"),
            valueLength = fild.val().length;

        if (valueLength === 0) {
            showFildError(parrentBlock, errorMessage.emptyFild)
        } else if (checkReg !== true) {
            showFildError(parrentBlock, errorMessage.incorrectEmail);
        } else {
            statusEmail = true;
            return statusEmail;
        }
        setTimeout(function () {
            clearFildError(fild)
        }, 3000);

    });


    $(".js-input-tel").on("blur", function () {

        var fild = $(this),
            fildValue = fild.val(),
            parrentBlock = fild.parent(".bl_form__label"),
            valueLength = fild.val().length;

        if (valueLength === 0) {
            showFildError(parrentBlock, errorMessage.emptyFild)
        } else if (valueLength < 7) {
            showFildError(parrentBlock, errorMessage.littleNumber)
        } else {
            statusPass = true;
            return statusPass;
        }
        setTimeout(function () {
            clearFildError(fild)
        }, 3000);

    });


    $(".js-input-pass").on("blur", function () {

        var fild = $(this),
            parrentBlock = fild.parent(".bl_form__label"),
            valueLength = fild.val().length;

        if (valueLength === 0) {
            showFildError(parrentBlock, errorMessage.emptyFild)
        } else if (valueLength < 7) {
            showFildError(parrentBlock, errorMessage.littlePass)
        } else {
            statusTel = true;
            return statusTel;
        }
        setTimeout(function () {
            clearFildError(fild)
        }, 3000);

    });

    ///////// SUBMIT FORM

    $('#RegisterForm').submit(function(e){
        e.preventDefault();
        remoteAuthorization('register', 'vulkan', ['Contact', 'Password']);
    });



    function showFildError(parrentBlock, errorText) {
        parrentBlock.addClass(errorClassEffect);
        parrentBlock.children(".bl_form__errors").addClass(active).html(errorText);
    }


    function isValidEmailAddress(emailAddress) {
        var pattern = new RegExp(
            /^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i
        );
        return pattern.test(emailAddress);
    }

    $(".js-input-tel").bind("change keyup input click", function () {
        if (this.value.match(/[^0-9+#*]/g)) {
            this.value = this.value.replace(/[^0-9+#*]/g, '');
        }

    });

    function clearFildError(fild) {
        fild.parent(".bl_form__label").removeClass(errorClassEffect);
        fild.siblings(".bl_form__errors").removeClass(active).html("");
    }


    /// RANDOM Number

    function randomInteger(min, max) {
        var rand = min - 0.5 + Math.random() * (max - min + 1);
        rand = Math.round(rand);
        return rand;
    }


    /// Links to Casinos
    $('.casino-link').attr('href', getLoginUrl());

    function getLoginUrl(){
        var queryData = getQueryData('vulkan');
        var params = (queryData.params === '?') ? '?login' : queryData.params + '&login';
        return queryData.mirror + params;
    }

    /// Generate Random Password
    // $('#RegisterForm_password').val(generate(6));
    //
    // function generate(len)
    // {
    //     var ints =[0,1,2,3,4,5,6,7,8,9];
    //     var chars=['a','b','c','d','e','f','g','h','j','k','l','m','n','o','p','r','s','t','u','v','w','x','y','z'];
    //     var out='';
    //     for(var i=0;i<len;i++){
    //         var ch=Math.random(1,2);
    //         if(ch<0.5){
    //             var ch2=Math.floor(Math.random(1,ints.length)*10);
    //             out+=ints[ch2];
    //         }else{
    //             var ch2=Math.floor(Math.random(1,chars.length)*10);
    //             out+=chars[ch2];
    //         }
    //     }
    //     return out;
    // }


    /// navigation

    var btnCurrency = $(".btn_currency"),
        btnCountry = $(".btn_country");

    btnCurrency.on("click", function () {
        $(".bl_currency__checker").toggleClass(hidden);

        setTimeout(function () {
            $(".bl_currency__checker").addClass(hidden);
        }, 2500);
    });

    $(".bl_currency__checkbox").on("change", function () {
       var val = $(this).next().text();
        btnCurrency.text(val).attr("data-currency", val);
        $(".bl_currency__checker").addClass(hidden);
    });

    btnCountry.on("click", function () {
        $('.bl_country__checker').toggleClass(hidden);

        setTimeout(function () {
            $(".bl_country__checker").addClass(hidden);
        }, 2500);
    });

    $(".bl_country__checkbox").on("change", function () {
        var val = $(this).next().text();
        btnCountry.text(val).attr("data-country", val);
        $('.bl_country__checker').addClass(hidden);
    })
    
    

});