window.onload = function () {

    var body = $("body"),
        active = "active",
        hidden = "hidden",

        btnMenu = $(".btn_menu"),
        mainMenu = $(".bl_navigation"),
        btnSubMenu = $(".btn_nav__mob"),
        marker = true,
        noScroll = 'noScroll',

        overlayBlock = $(".overlay"),
        subNav = $(".sub_nav");


    btnMenu.on("click", function () {

        if (body.width() < 1280) {

            if (marker) {
                //// CombineMenusOnly One time
                CombineMenusOnly();
                marker = false
            }

        }


        body.toggleClass(noScroll);
        // overlayBlock.toggleClass(hidden);

        $(this).toggleClass(active);
        mainMenu.toggleClass(active);

    });


    //// Testing
    // CombineMenusOnly();

    function CombineMenusOnly(){
        mainMenu.append($(".bl_aside"));
        $(".nav_clinic").unwrap();
    }




    btnSubMenu.on("click", function () {
        // btnSubMenu.removeClass(active); /// Если скажут переделать
        // subNav.removeClass(active);
        $(this).toggleClass(active);
        $(this).next("ul").toggleClass(active);
    });


    var btnShowMainMenu = $(".btn_showServices");


    btnShowMainMenu.on("click", function () {

        $(this).toggleClass(active);
        $(".bl_navigation__list").toggleClass(active);

    });


    //// Language
    $(".btn_choseLang").on("click", function () {
        $(this).toggleClass(active);

    });

    ///// Slider Services

    var services = $(".js-slider-services");
    var servicesLength = $(".bl_services__item").length;


    if (servicesLength > 4) {

        services.slick({
            dots: true,
            infinite: false,
            arrows: true,
            autoplay: false,
            autoplaySpeed: 3500,
            speed: 1500,
            slidesToShow: 4,
            slidesToScroll: 1,


            responsive: [
                {
                    breakpoint: 1680,
                    settings: {
                        slidesToShow: 3
                    }
                },
                {
                    breakpoint: 1480,
                    settings: {
                        slidesToShow: 2
                    }
                },
                {
                    breakpoint: 850,
                    settings: {
                        slidesToShow: 1.5
                    }
                },
                {
                    breakpoint: 600,
                    settings: {
                        slidesToShow: 1.5,
                        arrows: false,
                    }
                },


                {
                    breakpoint: 450,
                    settings: {
                        slidesToShow: 1.1,
                        arrows: false,
                    }
                },
                {
                    breakpoint: 340,
                    settings: {
                        slidesToShow: 1,
                        dots: false
                    }
                }
            ]

        });
    }

    //  Slider Partners

    var partnersSlider = $(".bl_ourPartners__list"),
        partners = $(".bl_ourPartners__link").length;

    if (partners > 5) {

        partnersSlider.slick({
            infinite: false,
            arrows: true,
            autoplay: false,
            autoplaySpeed: 3500,
            speed: 1500,
            slidesToShow: 5,
            slidesToScroll: 1,


            responsive: [
                {
                    breakpoint: 1680,
                    settings: {
                        slidesToShow: 4,
                    }
                },
                {
                    breakpoint: 1480,
                    settings: {
                        slidesToShow: 3,
                    }
                },
                {
                    breakpoint: 870,
                    settings: {
                        slidesToShow: 2.5,
                    }
                },
                {
                    breakpoint: 768,
                    settings: {
                        arrows:false,
                        slidesToShow: 2.5,
                    }
                }
            ]

        });

    }

    ////// Slider REVIEWS

    var reviewsSlider = $(".js-reviews"),
        rewiewsItems = $('.bl_review__item').length;


    if (rewiewsItems > 3) {

        reviewsSlider.slick({
            infinite: false,
            arrows: true,
            autoplay: false,
            autoplaySpeed: 3500,
            speed: 1500,
            slidesToShow: 3,
            slidesToScroll: 1,


            responsive: [
                {
                    breakpoint: 1480,
                    settings: {
                        slidesToShow: 2,
                    }
                },
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: 1,
                    }
                }
            ]

        });

    }










    ///////////////

    var buttonsPopup = $(".js-contactUs"),
        popup = $(".bl_popup"),

        btnClosePopup = $(".btn_close__popup");


    buttonsPopup.on("click", function () {
        body.addClass(noScroll);
        popup.removeClass(hidden);
        overlayBlock.removeClass(hidden);

    });


    closePopup(btnClosePopup);
    closePopup(overlayBlock);

    function closePopup(el) {
        el.on("click", function () {
            body.removeClass(noScroll);
            popup.addClass(hidden);
            overlayBlock.addClass(hidden);
        });
    }

    //// Footer Buttons



    if (body.width() < 1280) {
        $(".btn_footerMenu").on("click", function () {

            $(this).toggleClass(active);
            $(this).next().slideToggle();

        })


    }



    ////// FORM FOR USER
    ///// Contact  Form
    var
        errorClassEffect = "error_fild",
        statusContactForm = false,
        statusName = false,
        statusEmail = false,
        statusTel = false,
        statusMessage = false;


    var errorMessage = {
        shortName: "Очень короткое имя, введите, полное",
        longName: "Очень длинное сообщение, пожалуйста, сократите",
        emptyFild: "Поле должно быть заполненно",
        errorEmail: "Неправильные email",
        errorNumber: "Некоректный телефон",
        errorMessage: "Ошибка сообщения"
    };

/// checked corrected name

    $(".contactForm_name").on("blur", function () {
        var fild = $(this),
            valueLength = fild.val().length;

        if (valueLength === 0) {
            showFildError(fild, errorMessage.emptyFild)
        } else if (valueLength < 4) {
            showFildError(fild, errorMessage.shortName)
        } else if (valueLength > 40) {
            showFildError(fild, errorMessage.longName);

            setTimeout(function () {
                fild.val('');
            }, 3000);

        } else {
            statusName = true;
            return statusName;
        }

        setTimeout(function () {
            clearFildError(fild)
        }, 3000);
    });

    /// checked corrected email

    $(".contactForm_email").on("blur", function () {
        var fild = $(this),
            fildValue = fild.val(),
            valueLength = fild.val().length;
        var checkReg = isValidEmailAddress(fildValue);

        if (valueLength === 0) {
            showFildError(fild, errorMessage.emptyFild)
        } else if (checkReg !== true) {
            showFildError(fild, errorMessage.errorEmail);

        } else {
            statusEmail = true;
            return statusEmail;
        }
        setTimeout(function () {
            clearFildError(fild)
        }, 3000);
    });

    //// checked corrected message

    $(".contactForm_message").on("blur", function () {
        var fild = $(this),
            valueLength = fild.val().length;

        if (valueLength === 0) {
            showFildError(fild, errorMessage.emptyFild);
        } else if (valueLength < 4) {
            showFildError(fild, errorMessage.errorMessage);
        } else {
            statusMessage = true;
            return statusMessage;
        }
        setTimeout(function () {
            clearFildError(fild)
        }, 3000);

    });

    ///// Work with TABS

    var tabFields = $(".bl_tabs__field"),
        buttonsTab = $(".bl_tabs__btn");

    buttonsTab.on("click", function () {
        buttonsTab.removeClass(active);
        $(this).addClass(active);

        tabFields.addClass(hidden);
        tabFields.eq($(this).index()).removeClass(hidden);


    });


    //// checked corrected phone number

    $(".contactForm_tel").bind("change keyup input click", function () {
        if (this.value.match(/[^0-9+#*]/g)) {
            this.value = this.value.replace(/[^0-9+#*]/g, '');
        }

    });

    $(".contactForm_tel").on("blur", function () {

        var fild = $(this),
            value = fild.val(),
            valueLength = value.length;


        var checkReg = isValidTelephone(value);

        if (valueLength === 0) {
            showFildError(fild, errorMessage.emptyFild);
        } else if (checkReg === false) {
            showFildError(fild, errorMessage.errorNumber);
        } else {
            statusTel = true;
            return statusTel;
        }

        setTimeout(function () {
            clearFildError(fild)
        }, 3000);

    });


    function isValidTelephone(phoneNumber) {
        /// регулярка только на цифры и спец знаков
        var pattern = new RegExp(/[\d+#*]/);
        return pattern.test(phoneNumber);
    }

    function showFildError(fild, errorText) {
        fild.addClass(errorClassEffect);
        fild.siblings(".text_error").addClass(active).html(errorText);
    }


    function clearFildError(fild) {
        fild.removeClass(errorClassEffect);
        fild.siblings(".text_error").removeClass(active).html("");
    }

    function isValidEmailAddress(emailAddress) {
        var pattern = new RegExp(
            /^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i
        );
        return pattern.test(emailAddress);
    }


    ///////// SUBMIT FORM


    $(".contactForm_full").submit(function (e) {

        e.preventDefault();

        if ($(".contactForm_name").val().length === 0) {
            var fild1 = $(".contactForm_name");
            showFildError(fild1, errorMessage.emptyFild);
            setTimeout(function () {
                clearFildError(fild1)
            }, 3000);
        }
        if ($(".contactForm_tel").val().length === 0) {
            var fild2 = $(".contactForm_tel");
            showFildError(fild2, errorMessage.emptyFild);
            setTimeout(function () {
                clearFildError(fild2)
            }, 3000);
        }

        // FOR formForBusiness
        if ($(this).hasClass("js-formService")) {
            if ((statusName === true) && (statusTel === true)) status = true;
            return status;
        }

        /// ТУТ идет отправка формы
        if (status === true) {
            console.log("submit letter");
            $(".contactForm_full").submit();
        }


    });


    ////// Corrected field

    var allInput = $("input");


    if (body.width() < 480) {

        allInput.focus(function () {
            popup.addClass('inputBag');
        });

        allInput.blur(function () {
            popup.removeClass('inputBag');
        });

    }




};


