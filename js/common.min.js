$(document).ready(function () {
    $('.block--rating__stars__item').on('mouseover', function () {
        var stars = $(this).closest('.commentratingbox').find('.block--rating__stars__item');
        $(this).closest('.commentratingbox').find('.block--rating__stars__item').removeClass('cur');
        $(this).closest('.commentratingbox').find('.block--rating__stars__item').removeClass('active');
        $(this).closest('.commentratingbox').find('.block--rating__stars__item').removeClass('half');
        $(this).addClass('cur');
        var cur_index = 0;
        for (var i = 0; i < stars.length; i++) {
            if (stars[i].classList.contains('cur')) {
                cur_index = i;
                break;
            }
            stars[i].classList.add('active');
        }
    });

    $('.block--rating__stars__item').on('click', function () {
        $(this).closest('.commentratingbox').find('.block--rating__stars__item input').attr('checked', false);
        $(this).find('input').attr('checked', true);
    });

    $('.block--rating__stars__item').on('mouseleave', function () {
        $(this).closest('.commentratingbox').find('.block--rating__stars__item').removeClass('active');
        $(this).closest('.commentratingbox').find('.block--rating__stars__item').removeClass('cur');
        $(this).closest('.commentratingbox').find('.block--rating__stars__item').removeClass('half');
        var cur_index = $(this).closest('.commentratingbox').find('.block--rating__stars__item input[checked]').val();
        var cur_arr = $(this).closest('.commentratingbox').find('.block--rating__stars__item');
        for (let i = 0; i <= cur_index - 1; i++) {
            if (i !== cur_index - 1) {
                cur_arr[i].classList.add('active');
            } else {
                cur_arr[i].classList.add('cur');
            }
        }
    });

    var body = $("body");

    function startOverlay(inner) {
        body.append('<div class="overlay"><div class="light-container">' + inner + '</div></div>');
        $(".overlay").animate({"opacity": "1"}, 200, "linear");
        $(".light-container").css({
        }).animate({"opacity": "1"}, 200, "linear");
    }

    body.on("click", ".overlay", function () {
        $(".overlay").fadeOut(200);
        setTimeout(function () {
            $('.overlay').remove();
        }, 250);
    });

    $(".review-item__link").on("click", function (event) {
        event.preventDefault();
        var inner = $(this).closest('.review-item').html();
        startOverlay(inner);
    });

});