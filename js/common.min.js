/// ZirkaAndry created this fucking code =)
/// You can write me zirkaandry@gmail.com

$(document).ready(function(){
    /// LazyLoading Images
    window.lazySizesConfig = window.lazySizesConfig || {};
    window.lazySizesConfig.customMedia = {
        '--large': '(min-width: 2400px)',
    };

    if (!document.cookie.length) {
        $('.politic_ofCookies').fadeIn();
    }

    var
        body = $("body"),
        active = "active",
        browserWidth = body.width(),
        homePageURL = window.location.origin,
        hidden = "hidden";


    $('.ham').on("click", function () {
        $(this).toggleClass(active);
        $(".mobileWrapper").toggleClass(active);
        $(".bl_nav").toggleClass(active);
        $(".bl_nav__full").toggleClass(active);
        $(".logo_link").toggleClass(active);
    });

    body.on("click", ".btn_gameInfo", function () {
        $(this).closest(".bl_games__item").toggleClass(active);
    });


    ////////////// Play GAME

    body.on("click", ".js-playGame", function () {

        $('video').trigger('pause');

        $('body').addClass('unscroll');

        var gameID = homePageURL + '/netgame_games/db.php?game=' + $(this).data("href");
        var gameIDForMob = 'http://' + window.location.host + '/netgame_games/db.php?game=' + $(this).data("href"); /// For mobile Games dosen't work from https server

        // console.log("gameID = " + gameID);
        // console.log("gameIDForMob = " + gameIDForMob);

        // return;

        // if (checkIOS() === true) {
        //     //// If IOS redirect, because game programmers have curve hands
        //     window.location.href = gameIDForMob;
        //     return
        // }

        popupWrapper.html("");

        var
            gameWidth,
            gameHeight;

        if (window.innerWidth / window.innerHeight < 16 / 9) {
            gameWidth = (window.innerWidth * 0.9).toFixed();
            gameHeight = (gameWidth * 9 / 16).toFixed();
        } else {
            gameHeight = (window.innerHeight * 0.9).toFixed();
            gameWidth = (gameHeight / 9 * 16).toFixed();
        }



        // if ($(window).width() / $(window).height() < 1.6 ) {
        //
        //     //////// FIXED BUGS
        //
        //     var srcForMob = $(".js-mobSrc").data("mob-src");
        //
        //     window.location.href = srcForMob;
        //     return
        //
        // }

        var ajaxscript = {ajax_url: '/wp-admin/admin-ajax.php'};

        $.ajax({
            url: ajaxscript.ajax_url,
            dataType: 'json',
            data: {action: 'need_redirect'},
            method: 'get',
            beforeSend: function (response) {

            },
            success: function (response) {
                if(response.success) {
                    var srcForMob = $(".js-mobSrc").data("mob-src");

                    window.location.href = srcForMob;
                    return
                }
            },
            error: function (r) {
                console.log(r.message)
            }
        });


        $(".btn_close__iframe").removeClass(hidden);
        var currentGame = '<iframe class="iframe_game" src="' + gameID + '" width="' + gameWidth + '" height="' + gameHeight + '" frameborder="0" style="border:0" scrolling="no" vspace="0" hspace="0" marginwidth="0" marginheight="0" seamless allowfullscreen></iframe>';

        popup.removeClass(hidden);
        popupWrapper.html(currentGame);


    });


    $(".btn_close__iframe").on("click", function () {
        $(body).removeClass('unscroll');
        $('video').trigger('play');
        popupWrapper.html("");
        $(this).addClass(hidden);
        popup.addClass(hidden);
    });


    ///// Contact  Form
    var btnCloseForm = $(".btn_closeComplete"),
        timeShowErrorMessage = 4500,
        errorClassEffect = "error_fild",
        statusContactForm = false,
        statusName = false,
        statusEmail = false,
        statusTel = false,
        statusMessage = false,
        statusCV = false;


    var errorMessage = {
        shortName: "Very short name <br> please enter your full name",
        longName: "Too long name <br> please enter your real name",
        emptyFild: "This field must be filled",
        errorEmail: "invalid email",
        errorNumber: "invalid phone number <br> write only numbers",
        errorMessage: "please give a more detailed answer",
        errorLink: "it's not a link to portfolio"
    };


    body.on("click", ".btn_closeComplete", function () {
        $(".bl_complete").remove();
    });


    /// checked corrected name

    $(".contactForm_name").on("blur", function () {
        var fild = $(this),
            valueLength = fild.val().length;

        if (valueLength === 0) {
            showFildError(fild, errorMessage.emptyFild)
        } else if (valueLength < 4) {
            showFildError(fild, errorMessage.shortName)
        } else if (valueLength > 40) {
            showFildError(fild, errorMessage.longName);

            setTimeout(function () {
                fild.val('');
            }, 3000);

        } else {
            statusName = true;
            return statusName;
        }

        setTimeout(function () {
            clearFildError(fild)
        }, 3000);
    });

    /// checked corrected email

    $(".contactForm_email").on("blur", function () {
        var fild = $(this),
            fildValue = fild.val(),
            valueLength = fild.val().length;
        var checkReg = isValidEmailAddress(fildValue);

        if (valueLength === 0) {
            showFildError(fild, errorMessage.emptyFild)
        } else if (checkReg !== true) {
            showFildError(fild, errorMessage.errorEmail);

        } else {
            statusEmail = true;
            return statusEmail;
        }
        setTimeout(function () {
            clearFildError(fild)
        }, 3000);
    });

    //// checked corrected message

    $(".contactForm_message").on("blur", function () {
        var fild = $(this),
            valueLength = fild.val().length;

        if (valueLength === 0) {
            showFildError(fild, errorMessage.emptyFild);
        } else if (valueLength < 4) {
            showFildError(fild, errorMessage.errorMessage);
        } else {
            statusMessage = true;
            return statusMessage;
        }
        setTimeout(function () {
            clearFildError(fild)
        }, 3000);

    });

    //// checked corrected phone number

    $(".contactForm_tel").bind("change keyup input click", function () {
        if (this.value.match(/[^0-9+#*]/g)) {
            this.value = this.value.replace(/[^0-9+#*]/g, '');
        }

    });

    $(".contactForm_tel").on("blur", function () {

        var fild = $(this),
            value = fild.val(),
            valueLength = value.length;


        var checkReg = isValidTelephone(value);

        if (valueLength === 0) {
            showFildError(fild, errorMessage.emptyFild);
        } else if (checkReg === false) {
            showFildError(fild, errorMessage.errorNumber);
        } else {
            statusTel = true;
            return statusTel;
        }

        setTimeout(function () {
            clearFildError(fild)
        }, 3000);

    });


    function isValidTelephone(phoneNumber) {
        /// регулярка только на цифры и спец знаков
        var pattern = new RegExp(/[\d+#*]/);
        return pattern.test(phoneNumber);
    }

    //////// checked CV LINK

    $(".contactForm_cvLink").on("blur", function () {
        var fild = $(this),
            value = fild.val(),
            valueLength = value.length;
        if (valueLength > 120) {
            showFildError(fild, errorMessage.longName);

            setTimeout(function () {
                fild.val('');
            }, 3000);

        } else {
            statusCV = true;
            return statusCV;
        }

        setTimeout(function () {
            clearFildError(fild)
        }, 3000);

    });


    ////// checked file
    var btnLoadCV = $(".btn_resetCV");

    $(".contactForm_cvLoad").change(function () {
        var fileName = $(this).val();
        fileName = fileName.split(/\\+/);


        btnLoadCV.addClass(active).text(fileName[fileName.length - 1]);
    });


    btnLoadCV.on("click", function () {
        $(".contactForm_cvLoad").val("");
        $(this).removeClass(active);
    });


    ///////// SUBMIT FORM


    $(".contactForm_full").submit(function (e) {

        e.preventDefault();

        // check if the input is valid


        // FOR formForBusiness
        if ($(this).hasClass("js-formForBusiness")) {
            if ((statusName === true) && (statusEmail === true) && (statusMessage === true)) status = true;
            return status;
        }

        /// ТУТ идет отправка формы
        // if (status === true) {
        //     $(".contactForm_full").submit();
        // }


    });

    function showFildError(fild, errorText) {
        fild.addClass(errorClassEffect);
        fild.siblings(".text_error").addClass(active).html(errorText);
    }


    function clearFildError(fild) {
        fild.removeClass(errorClassEffect);
        fild.siblings(".text_error").removeClass(active).html("");
    }

    function isValidEmailAddress(emailAddress) {
        var pattern = new RegExp(
            /^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i
        );
        return pattern.test(emailAddress);
    }


    /// WORK WITH POPUP

    /// Show Map

    var
        // btnMap = $(".bl_map"),
        // map = '<iframe class="iframe_map" src="https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d2541.654920380269!2d30.520416987226834!3d50.428900696325016!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x40d4cf1b7b70e1f5%3A0xe9fe0e1a4d1f7aea!2z0YPQuy4g0JLQsNGB0LjQu9C40Y8g0KLRjtGC0Y7QvdC90LjQutCwLCA10JEsINCa0LjQtdCyLCDQo9C60YDQsNC40L3QsCwgMDIwMDA!5e0!3m2!1sru!2sde!4v1550840194329&amp;hl=en&amp;ie=UTF8&amp;t=&amp;z=14&amp;iwloc=B&amp;output=embed" frameborder="0"></iframe>',

        popup = $(".bl_popup"),
        popupWrapper = $(".bl_popup__wrapper");


    // btnMap.on("click", function () {
    //     popup.removeClass(hidden);
    //     popupWrapper.html(map);
    // });


    //// Clearing popup inner
    popup.on("click", function () {
        popupWrapper.empty();
        popup.addClass(hidden);
        $('body').removeClass('unscroll');
    });

    // Close popup on Esc
    body.keydown(function (e) {
        if (e.which === 27) {
            if ($(".bl_popup").length > 0) {
                popupWrapper.empty();
                popup.addClass(hidden);
                $('body').removeClass('unscroll');
            }
        }
    });


    ////////////// COOCKIES POLITIC

    $('.politic_ofCookies__close').on('click', function() {
        politicOfCookies.remove();
    });

    var btnConfirmCookies = $(".js-cookies"),
        politicOfCookies = $("body .politic_ofCookies");

    var ajaxscript = {ajax_url: '/wp-admin/admin-ajax.php'};
    btnConfirmCookies.one("click", function () {

        $.ajax({
            url: ajaxscript.ajax_url,
            dataType: 'json',
            data: {action: 'set_cookies_confirm'},
            method: 'post',
            beforeSend: function (response) {
                if (response) {
                    // hide coockies
                    politicOfCookies.remove();
                }
            },
            success: function (response) {
                // if (response) {
                //     console.log(response);
                // }
            },
            error: function (r) {
                console.log(r.message)
            }
        });
    });

    /// Cookies for Invitation Banner
    /// Invitation Banner   Баннер об конференции

    /*
    var btnInvitationBanner = $(".btn_invitation_banner");

    btnInvitationBanner.one("click", function () {
        setCookiesForInvitationBanner();
    });


    function setCookiesForInvitationBanner (){
        $.ajax({
            url: ajaxscript.ajax_url,
            dataType: 'json',
            data: {action: 'set_cookies_invitationBanner'},
            method: 'post',
            success: function (response) {
                if (response) {
                    // console.log(response);
                } else {
                    console.log(response);
                }
            },
            error: function (r) {
                console.log(r.message)
            }
        });
    }


    btnInvitationBanner.on("click", function () {


        $(this).toggleClass(active);
        $(".invitation_banner__link").toggleClass(active);
    });

    $(".close_invitation_banner").one("click", function () {
        $(this).parent(".invitation_banner").hide(100, 'swing');
        setCookiesForInvitationBanner(); /// If user ones close bunner he will not see this banner agane on mobile on all pages.
    });

    */



});



