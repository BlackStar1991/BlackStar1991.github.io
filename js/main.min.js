"use strict";
var cleo, cleo_cont, currAnim, stopAnim, arrFS, arrUAH, showCounts, renderer, stage;
function initLend() {
    cleo_cont = $(".cleo-cont"),
        currAnim = parseInt(cleo_cont.attr("data-steps").split(",")[0]),
        currAnim = Math.min(Math.max(currAnim, 1), 5),
        stopAnim = parseInt(cleo_cont.attr("data-steps").split(",")[1]),
        stopAnim = Math.min(Math.max(stopAnim, 1), 5),
        arrFS = cleo_cont.attr("data-fs").split(","),
        arrUAH = cleo_cont.attr("data-money").split(","),
    (showCounts = parseInt(cleo_cont.attr("data-count-show"))) && $(".cleo-count").css("opacity", "1")
}
function initResizeCleo() {
    var a = $(".cleo-cont");
    $(window).resize(function() {
        var e = $(window).width() / 1286
            , t = $(window).height() / 1500
            , n = e < t ? e : t;
        n = Math.min(n, 1),
            a.css("transform", "translate(-50%, -50%) scale(" + n + ")"),
            a.css("transform", "-webkit-translate(-50%, -50%) scale(" + n + ")"),
            a.css("transform", "-moz-translate(-50%, -50%) scale(" + n + ")"),
            a.css("transform", "-o-translate(-50%, -50%) scale(" + n + ")");
        var o = 1026 * n + parseInt(a.css("top")) - 500;
        $(window).width() < 1e3 && 500 < $(window).width() && (o += 120),
            $(".payments").css("top", o.toFixed(0) + "px");
        var i = o - $(".icons").height() - 100;
        $(".icons").css("top", i.toFixed(0) + "px")
    }),
        $(window).trigger("resize")
}
function initCleo() {
    var e = $(".cleo");
    renderer = PIXI.autoDetectRenderer(1929, 1026, {
        transparent: !0
    }),
        e.append(renderer.view),
        stage = new PIXI.Container;
    PIXI.loader.add("cleo", "images/cleo/animation_double_up_cleo.json").on("progress", onAssetsProgress).load(onAssetsLoaded);
    requestAnimationFrame(animate)
}
function onAssetsProgress(e, t) {}
function onAssetsLoaded(e, t) {
    (cleo = new PIXI.spine.Spine(t.cleo.spineData)).position.x = renderer.width / 2,
        cleo.position.y = renderer.height / 2,
        cleo.scale.set(.75),
        stage.addChild(cleo),
        $(".cleo-dark").animate({
            opacity: 0
        }, 500),
        cleo.state.setAnimation(0, "dance_clothing_" + currAnim, !0),
        cleo.state.addListener({
            end: step1AnimationEnd
        }),
        step0initCleo()
}
function step0initCleo() {
    cleo.stateData.setMix("dance_clothing_" + currAnim, "pressed_right", .5),
        cleo.stateData.setMix("dance_clothing_" + currAnim, "pressed_left", .5),
        cleo.stateData.setMix("dance_clothing_" + currAnim, "reveal_right_" + currAnim, .5),
        cleo.stateData.setMix("dance_clothing_" + currAnim, "reveal_left_" + currAnim, .5),
        cleo.stateData.setMix("reveal_right_" + currAnim + "_win", "dance_clothing_" + (currAnim + 1), .5),
        cleo.stateData.setMix("reveal_left_" + currAnim + "_win", "dance_clothing_" + (currAnim + 1), .5),
        $(".cleo-right-btn").css("pointer-events", "auto").css("cursor", "pointer").bind("mouseover", lotusRightOver).bind("mouseout", lotusRightOut).bind("click", step1RightClick),
        $(".cleo-left-btn").css("pointer-events", "auto").css("cursor", "pointer").bind("mouseover", lotusLeftOver).bind("mouseout", lotusLeftOut).bind("click", step1LeftClick)
}
function lotusRightOver() {
    cleo.state.addAnimation(1, "pressed_right", !0, 0),
        $(".cleo-arrow-left").removeClass("anim")
}
function lotusRightOut() {
    cleo.state.addAnimation(1, "pressed_right", !1, 0),
        $(".cleo-arrow-left").addClass("anim")
}
function lotusLeftOver() {
    cleo.state.addAnimation(1, "pressed_left", !0, 0),
        $(".cleo-arrow-right").removeClass("anim")
}
function lotusLeftOut() {
    cleo.state.addAnimation(1, "pressed_left", !1, 0),
        $(".cleo-arrow-right").addClass("anim")
}
function animate() {
    requestAnimationFrame(animate),
        renderer.render(stage)
}
function disableBtns() {
    $(".cleo-right-btn").unbind().css("cursor", "default").css("pointer-events", "none"),
        $(".cleo-left-btn").unbind().css("cursor", "default").css("pointer-events", "none")
}
function step1RightClick() {
    disableBtns(),
        lotusRightOut(),
        cleo.state.setAnimation(0, "reveal_right_" + currAnim, !1),
        cleo.state.addAnimation(0, "reveal_right_" + currAnim + "_win", !1, 0),
        cleo.state.addAnimation(0, "dance_clothing_" + (currAnim + 1), !0, 0),
        $(".cleo-arrow-left").removeClass("anim"),
        $(".cleo-arrows").animate({
            opacity: 0
        }, 500)
}
function step1LeftClick() {
    disableBtns(),
        lotusLeftOut(),
        cleo.state.setAnimation(0, "reveal_left_" + currAnim, !1),
        cleo.state.addAnimation(0, "reveal_left_" + currAnim + "_win", !1, 0),
        cleo.state.addAnimation(0, "dance_clothing_" + (currAnim + 1), !0, 0),
        $(".cleo-arrow-right").removeClass("anim"),
        $(".cleo-arrows").animate({
            opacity: 0
        }, 500)
}
function step1AnimationEnd(e) {
    e.animation.name !== "reveal_right_" + currAnim && e.animation.name !== "reveal_left_" + currAnim || setCounts(currAnim),
    e.animation.name !== "reveal_right_" + currAnim + "_win" && e.animation.name !== "reveal_left_" + currAnim + "_win" || setTimeout(showPopup, 2e3, stopAnim - currAnim)
}
function showPopup(e) {
    $(".popup").css("pointer-events", "auto").animate({
        opacity: 1
    }, 500),
    0 !== e && ($(".popup-play-btn").bind("click", step2Start),
        $(".popup-bonus").html(arrFS[currAnim - 1] + " Фриспинов"),
        currAnim++),
    0 === e && ($(".popup-play-btn").css("display", "none"),
        $(".popup-bonus").html("225 ФС + " + " 150% "),
        setCookie("cleo-bonus-kosmo", 1))
}
function step2Start() {
    $(".popup-play-btn").unbind("click", step2Start),
        $(".popup").css("pointer-events", "none").animate({
            opacity: 0
        }, 500),
        step0initCleo(),
        $(".cleo-arrow-left").addClass("anim"),
        $(".cleo-arrow-right").addClass("anim"),
        $(".cleo-arrows").animate({
            opacity: 1
        }, 500)
}
$(document).ready(function() {
    getCookie("cleo-bonus-kosmo") ? (initLend(),
        currAnim = stopAnim,
        initResizeCleo(),
        showPopup(0)) : (initLend(),
        initResizeCleo(),
        initCleo())
});
var _obj = {
    fs: 0,
    uah: 0
};
function setCounts(e) {
    var t = parseInt($(".count-fs-value").html())
        , n = parseInt($(".count-uah-value").html());
    t !== arrFS[e - 1] && $(_obj).animate({
        fs: arrFS[e - 1]
    }, {
        duration: 5e3,
        queue: !1,
        step: updateFS
    }),
    n !== arrUAH[e - 1] && $(_obj).animate({
        uah: arrUAH[e - 1]
    }, {
        duration: 5e3,
        queue: !1,
        step: updateUAH
    })
}
function updateFS(e) {
    $(".count-fs-value").html(Math.round(e))
}
function updateUAH(e) {
    $(".count-uah-value").html(Math.round(e))
}
function getCookie(e) {
    var t = document.cookie.match(new RegExp("(?:^|; )" + e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, "\\$1") + "=([^;]*)"));
    return t ? decodeURIComponent(t[1]) : void 0
}
function setCookie(e, t, n) {
    var o = (n = n || {}).expires;
    if ("number" == typeof o && o) {
        var i = new Date;
        i.setTime(i.getTime() + 1e3 * o),
            o = n.expires = i
    }
    o && o.toUTCString && (n.expires = o.toUTCString());
    var a = e + "=" + (t = encodeURIComponent(t));
    for (var r in n) {
        a += "; " + r;
        var s = n[r];
        !0 !== s && (a += "=" + s)
    }
    document.cookie = a
}
